<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üìò 2025 Work Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8f8f8; }
    h1 { text-align: center; margin-bottom: 30px; }
    details { margin-bottom: 20px; border: 1px solid #ccc; border-radius: 6px; background: #fff; padding: 10px; }
    summary { font-size: 1.2em; font-weight: bold; cursor: pointer; }
    .day-block { margin-bottom: 10px; padding: 10px; border: 1px solid #eee; border-radius: 6px; background: #fdfdfd; }
    .day-block label { font-weight: bold; display: block; margin-bottom: 5px; }
    textarea {
      width: 100%;
      height: 60px;
      border-radius: 4px;
      border: 1px solid #ccc;
      padding: 8px;
      resize: vertical;
      box-sizing: border-box;
      font-size: 14px;
    }
    .upload-section { margin-top: 10px; }
    .status { margin-top: 6px; font-size: 0.9em; }
    .link { word-break: break-all; }
  </style>
</head>
<body>
  <h1>üìò 2025 Work Tracker</h1>

  <!-- Simple note: replace YOUR_VERCEL_URL below with your deployed Vercel function URL -->
  <script>
    const VERCEL_UPLOAD_URL = "https://work-tracker-9kgo73bl9-muhammadusman3506s-projects.vercel.app/api/upload"; // <-- REPLACE THIS

    const months = {
      "January": 31, "February": 28, "March": 31, "April": 30, "May": 31, "June": 30,
      "July": 31, "August": 31, "September": 30, "October": 31, "November": 30, "December": 31
    };

    document.addEventListener('DOMContentLoaded', () => {
      const body = document.body;
      for (const [month, days] of Object.entries(months)) {
        const details = document.createElement('details');
        const summary = document.createElement('summary');
        summary.innerText = month;
        details.appendChild(summary);

        for (let day = 1; day <= days; day++) {
          const dateStr = `2025-${String(Object.keys(months).indexOf(month)+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
          const weekday = new Date(dateStr).toLocaleDateString('en-US', { weekday: 'long' });
          const id = `${month}_${day}`;
          const block = document.createElement('details');
          block.className = 'day-block';
          const blockSummary = document.createElement('summary');
          blockSummary.innerText = `Day ${day} (${weekday})`;
          block.appendChild(blockSummary);
          block.innerHTML += `
            <label for="${id}">Write Day Work:</label>
            <textarea id="${id}" placeholder="Write your work..."></textarea>
            <div class="upload-section">
              <label for="${id}_file">Project Workspace:</label>
              <input type="file" id="${id}_file" name="${id}_file">
              <div class="status" id="${id}_status"></div>
            </div>
          `;
          details.appendChild(block);
        }
        body.insertBefore(details, body.lastElementChild);
      }

      // Save textarea text in localStorage
      const allTextareas = document.querySelectorAll('textarea');
      allTextareas.forEach(textarea => {
        const id = textarea.id;
        textarea.value = localStorage.getItem(id) || '';
        textarea.addEventListener('input', () => {
          localStorage.setItem(id, textarea.value);
        });
      });

      // File upload listener
      document.addEventListener('change', function(event) {
        if (event.target.type === "file" && event.target.files.length > 0) {
          const file = event.target.files[0];
          const dayId = event.target.id.replace("_file", ""); // e.g. "January_1"
          const path = `uploads/${dayId}/${file.name}`; // Upload path in repo
          const statusEl = document.getElementById(dayId + "_status");
          statusEl.textContent = "Preparing upload...";
          uploadFileToBackend(file, path, statusEl);
        }
      });
    });

    async function uploadFileToBackend(file, uploadPath, statusEl) {
      try {
        // Read file as base64
        const arrayBuffer = await file.arrayBuffer();
        const base64Content = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));

        statusEl.textContent = "Uploading...";
        const resp = await fetch(VERCEL_UPLOAD_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            filename: uploadPath,
            contentBase64: base64Content,
            commitMessage: `Add ${file.name} for ${uploadPath}`
          })
        });

        const result = await resp.json();
        if (resp.ok) {
          statusEl.innerHTML = '‚úÖ Uploaded. File URL: <a class="link" target="_blank" href="' + result.fileUrl + '">' + result.fileUrl + '</a>';
        } else {
          statusEl.textContent = '‚ùå Upload failed: ' + (result.error || result.message || JSON.stringify(result));
        }
      } catch (err) {
        statusEl.textContent = 'Error: ' + err.message;
      }
    }
  </script>
</body>
</html>
